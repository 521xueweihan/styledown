#!/usr/bin/env node
var meow = require('meow')
var styledown = require('../index')
var read = require('read-input')

var cli = require('meow')([
  'Usage:',
  '  $ styledown',
  '',
  'Options:',
  "  -F, --format <FMT>  sets output format ('json' or 'yaml')",
  "      --yaml          same as '--format yaml'",
  ' -R, --render         render as HTML',
  '',
  'Other options:',
  '  -h, --help          show usage information',
  '  -v, --version       print version info and exit'
].join('\n'), {
  boolean: ['help', 'version', 'yaml', 'render'],
  string: ['format'],
  alias: {
    h: 'help', v: 'version', F: 'format', R: 'render'
  }
})

read(cli.input)
.then(function (res) {
  res.files.forEach(function (file) {
    if (file.error) throw file.error
  })
  var output = styledown.parse(res.files)

  if (cli.flags.render) {
    process.stdout.write(styledown.render(output))
  } else {
    if (cli.flags.yaml || cli.flags.format === 'yaml') {
      console.log(require('js-yaml').safeDump(output))
    } else {
      console.log(JSON.stringify(output, null, 2))
    }
  }
})
